# Game server (многопользовательская игра “Dog Story”)

## Механика игры
Игрок управляет псом, задача которого — находить потерянные вещи и относить их в ближайшее бюро находок. На карте одновременно присутствуют несколько псов, которыми управляют другие пользователи, подключившиеся к серверу. Цель игры — набрать как можно больше игровых очков, которые начисляются за доставленные в бюро находок вещи.
На дорогах время от времени появляются потерянные вещи, которые нужно подобрать раньше противников и отнести в ближайшее бюро находок. Псы, управляемые игроками, могут нести не более трёх предметов за раз, поэтому регулярно нужно наведываться в офис.

## Архитектура игры
Игра выполнена в виде клиент-серверного приложения:

- Сервер отвечает за хранение и обновление игрового состояния, отправку состояния клиентам, обработку команд управления собаками. Размещение игрового кода на стороне сервера поставит игроков в одинаковые условия и уменьшит возможность жульничества путём модификации кода, выполняемого на стороне клиента.
- Клиент принимает ввод пользователя и отправляет его на сервер. Также клиент получает актуальное игровое состояние с сервера и отображает его пользователю. Клиентская часть игры (фронтенд) будет выполняться в веб-браузере и использовать технологии HTML/CSS/JavaScript.

Игровой сервер предоставляет клиентам `REST API`. Он поможет получить доступ к текущему состоянию игры: получить состояние игры и управлять движением своего курьера.

## Обзор серверной части игры
Сервер выполняет следующие задачи:

- Хранение и управление состоянием игры. Состояние игры включает в себя данные о картах и игроках, подключённых к игре. На сервере реализована игровая логика: правила перемещения игроков и их взаимодействия с объектами на карте, начисление баллов.
- Отдача статических файлов необходимых для работы игры в браузере: изображения, код на HTML/CSS/JavaScript.
- Обработка клиентских запросов: получение информации об игровом состоянии, получение команд управления псами.

### Опции для запуска сервера
- "help,h" : вывод справки;
- "tick-period,t" (ms) : указание периода обновления игрового состояния; 
- "config-file,c" (file) : путь к конфигурационному файлу;
- "www-root,w" (dir) : путь к каталогу со статическими файла (frontend);
- "randomize-spawn-points" : включение рандомной генерации позиции игрока на игровом поле;
- "state-file" (file) : путь к файлу для сохранения состояния;
- "save-state-period" (ms) : период сохранения состояния в файл;

Как формат конфигурационных файлов сервер использует JSON(с помощью `Boost.Json`).  
При остановке сервера или через заданный промежуток времени состояние сохраняется в указанный при запуске сервера файл.  
При выходе игрока из игры (выходом считается неподвижность игрока в течение заданного времени) результаты записываются в базу данных (`PostgreSQL`), а токен для доступа в игру аннулируется. Путь к базе задается через переменную окружения `GAME_DB_URL`.

## Сборка и запуск сервера
Поддерживается запуск в docker-контейнере.

Для запуска локально:
```
$ mkdir ./cpp-game_server/build && cd ./cpp-game_server/build
$ conan install .. --build=missing -s build_type=Release -s compiler.libcxx=libstdc++11
$ cmake -DCMAKE_BUILD_TYPE=Release ..
$ cmake --build ..
```
CMake, Conan, Boost 1.78, gcc-11, gnu++20.
